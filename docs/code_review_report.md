# ä»£ç è´¨é‡å®¡æŸ¥æŠ¥å‘Š

**é¡¹ç›®åç§°**: è§†åŠŸèƒ½è‡ªåŠ¨åˆ†æApp  
**å®¡æŸ¥æ—¥æœŸ**: 2026-02-18  
**å®¡æŸ¥èŒƒå›´**: å…¨é¡¹ç›®ä»£ç ï¼ˆlib/ å’Œ test/ï¼‰  
**ä»£ç ç»Ÿè®¡**: 26ä¸ªDartæ–‡ä»¶ï¼Œçº¦14,000+è¡Œä»£ç   

---

## ğŸ“Š å®¡æŸ¥æ‘˜è¦

### æ•´ä½“è¯„çº§: ğŸŸ¡ C+ (éœ€è¦æ”¹è¿›)

```
ä»£ç å¥åº·åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60%
å¯ç»´æŠ¤æ€§:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 55%
è§„èŒƒæ€§:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%
å®‰å…¨æ€§:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 80%
```

### é—®é¢˜ç»Ÿè®¡
- âŒ **è‡´å‘½é”™è¯¯**: 15ä¸ª
- âš ï¸ **è­¦å‘Š**: 8ä¸ª
- â„¹ï¸ **ä¿¡æ¯æç¤º**: 56ä¸ª
- **æ€»è®¡**: 79ä¸ªé—®é¢˜

---

## ğŸš¨ è‡´å‘½é”™è¯¯ (15ä¸ª) - å¿…é¡»ä¿®å¤

### 1. å‘½åä¸ä¸€è‡´é—®é¢˜ (13ä¸ªé”™è¯¯)
**ä½ç½®**: 
- `lib/presentation/widgets/indicator_input.dart:219-224`
- `lib/presentation/pages/data_entry_page.dart:405-410`

**é—®é¢˜**: 
ä»£ç ä¸­ä½¿ç”¨äº† `range.min` å’Œ `range.max`ï¼Œä½† `IndicatorRange` ç±»å®šä¹‰çš„å±æ€§æ˜¯ `minValue` å’Œ `maxValue`ã€‚

**é”™è¯¯ä»£ç **:
```dart
// é”™è¯¯ï¼IndicatorRange æ²¡æœ‰ min/max å±æ€§
if (range.min != null && range.max != null) {
  return '${range.min} - ${range.max}';
}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```dart
// æ­£ç¡®ï¼åº”è¯¥ä½¿ç”¨ minValue å’Œ maxValue
if (range.minValue != null && range.maxValue != null) {
  return '${range.minValue} - ${range.maxValue}';
}
```

**ä¼˜å…ˆçº§**: ğŸ”´ P0 - é˜»å¡ç¼–è¯‘

---

### 2. ç¼ºå°‘å¿…éœ€å‚æ•° (1ä¸ªé”™è¯¯)
**ä½ç½®**: `lib/presentation/pages/data_entry_page.dart:55`

**é—®é¢˜**: `IndicatorStandard` æ„é€ å‡½æ•°ç¼ºå°‘å¿…éœ€çš„ `ranges` å‚æ•°

**ä¿®å¤å»ºè®®**: æ£€æŸ¥æ„é€ å‡½æ•°è°ƒç”¨ï¼Œæä¾›å¿…éœ€çš„ `ranges` å‚æ•°

---

### 3. æœªå®šä¹‰çš„å‚æ•° (1ä¸ªé”™è¯¯)
**ä½ç½®**: `lib/presentation/pages/data_entry_page.dart:62`

**é—®é¢˜**: ä½¿ç”¨äº†æœªå®šä¹‰çš„ `normalRanges` å‚æ•°

---

## âš ï¸ è­¦å‘Š (8ä¸ª) - å»ºè®®ä¿®å¤

### 1. æœªä½¿ç”¨çš„å¯¼å…¥ (4ä¸ªè­¦å‘Š)
**æ–‡ä»¶**:
- `patient_detail_page.dart:4,7,8` - 3ä¸ªæœªä½¿ç”¨çš„å¯¼å…¥
- `patient_list_page.dart:3` - 1ä¸ªæœªä½¿ç”¨çš„å¯¼å…¥
- `patient_repository_test.dart:4` - 1ä¸ªæœªä½¿ç”¨çš„å¯¼å…¥

**å½±å“**: å¢åŠ ç¼–è¯‘æ—¶é—´ï¼Œä»£ç å†—ä½™

**ä¿®å¤**: åˆ é™¤æœªä½¿ç”¨çš„ import è¯­å¥

---

### 2. æœªä½¿ç”¨çš„å˜é‡ (1ä¸ªè­¦å‘Š)
**ä½ç½®**: `lib/presentation/widgets/indicator_input.dart:307`

**ä»£ç **:
```dart
final theme = Theme.of(context); // æœªä½¿ç”¨
```

---

### 3. ä¾èµ–åŒ…é—®é¢˜ (2ä¸ªè­¦å‘Š)
- `mockito` åŒ…æœªåœ¨ä¾èµ–ä¸­å£°æ˜
- `mockito` å¯¼å…¥ URI ä¸å­˜åœ¨

**ä¿®å¤**: åœ¨ `pubspec.yaml` çš„ `dev_dependencies` ä¸­æ·»åŠ  `mockito: ^5.4.4`

---

## â„¹ï¸ ä¿¡æ¯æç¤º (56ä¸ª) - å»ºè®®ä¼˜åŒ–

### 1. å·²å¼ƒç”¨çš„APIä½¿ç”¨ (10ä¸ª)
**é—®é¢˜**: ä½¿ç”¨äº† `withOpacity` æ–¹æ³•ï¼Œå·²åœ¨ Flutter 3.x ä¸­å¼ƒç”¨

**ä½ç½®**:
- `camera_scan_page.dart:402`
- `exam_type_selection_page.dart:148`
- `home_page.dart:24`
- `patient_list_page.dart:175`
- `loading_overlay.dart:63,220`

**ä¿®å¤æ–¹æ¡ˆ**:
```dart
// æ—§ä»£ç ï¼ˆå·²å¼ƒç”¨ï¼‰
Color.withOpacity(0.1)

// æ–°ä»£ç ï¼ˆæ¨èï¼‰
Color.withValues(alpha: 0.1)
```

---

### 2. BuildContext å¼‚æ­¥ä½¿ç”¨è­¦å‘Š (2ä¸ª)
**ä½ç½®**:
- `patient_detail_page.dart:640`
- `patient_list_page.dart:546`

**é—®é¢˜**: åœ¨ async æ–¹æ³•ä¸­ä½¿ç”¨äº† BuildContextï¼Œå¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡å¤±æ•ˆ

**é£é™©**: å¦‚æœ widget åœ¨å¼‚æ­¥æ“ä½œå®Œæˆå‰è¢«é”€æ¯ï¼Œä½¿ç”¨ BuildContext ä¼šå¯¼è‡´å´©æºƒ

**ä¿®å¤æ–¹æ¡ˆ**:
```dart
// åœ¨å¼‚æ­¥æ“ä½œå‰æ£€æŸ¥ mounted
if (!mounted) return;
Navigator.push(...);

// æˆ–åœ¨å¼‚æ­¥æ“ä½œåæ£€æŸ¥
final result = await someAsyncOperation();
if (!mounted) return;
Navigator.push(...);
```

---

### 3. æ–‡æ¡£æ³¨é‡Šé—®é¢˜ (1ä¸ª)
**ä½ç½®**: `lib/presentation/widgets/widgets.dart:1`

**é—®é¢˜**: æ‚¬æµ®çš„åº“æ–‡æ¡£æ³¨é‡Š

---

### 4. æµ‹è¯•æ–‡ä»¶ä¸­çš„æœªå®šä¹‰æ ‡è¯†ç¬¦ (14ä¸ª)
**é—®é¢˜**: æµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨äº†æœªå®šä¹‰çš„ `AbnormalLevel`

**ä¿®å¤**: éœ€è¦æ­£ç¡®å¯¼å…¥ `indicator_standard_model.dart`

```dart
import 'package:vision_analyzer/core/constants/indicator_standards/indicator_standard_model.dart';
```

---

## ğŸ”§ ä»£ç è§„èŒƒé—®é¢˜

### 1. å‘½åè§„èŒƒ
âœ… æ•´ä½“è‰¯å¥½ï¼Œä½†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- éƒ¨åˆ†å˜é‡å‘½åå¯ä»¥æ›´æ¸…æ™°
- å»ºè®®ç»Ÿä¸€ä½¿ç”¨é©¼å³°å‘½åæ³•

### 2. ä»£ç ç»„ç»‡
âœ… é¡¹ç›®ç»“æ„æ¸…æ™°ï¼š
```
lib/
â”œâ”€â”€ core/         (å¸¸é‡ã€å·¥å…·)
â”œâ”€â”€ data/         (æ•°æ®å±‚)
â”œâ”€â”€ domain/       (ä¸šåŠ¡é€»è¾‘)
â””â”€â”€ presentation/ (UIå±‚)
```

### 3. æ³¨é‡Šè¦†ç›–ç‡
âš ï¸ éœ€è¦æ”¹è¿›ï¼š
- å…¬å…± API ç¼ºå°‘æ–‡æ¡£æ³¨é‡Š
- å¤æ‚é€»è¾‘ç¼ºå°‘è¯´æ˜
- å»ºè®®æ³¨é‡Šè¦†ç›–ç‡è¾¾åˆ° 15%+

---

## ğŸ›¡ï¸ å®‰å…¨æ€§è¯„ä¼°

### âœ… å®‰å…¨å®è·µ
1. **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ âœ…
2. **è¾“å…¥éªŒè¯**: Repository å±‚æœ‰åŸºæœ¬çš„å‚æ•°éªŒè¯ âœ…
3. **é”™è¯¯å¤„ç†**: æœ‰ try-catch å— âœ…

### âš ï¸ æ½œåœ¨é£é™©
1. **æ–‡ä»¶æ“ä½œ**: PDFå¯¼å‡ºæ—¶æ–‡ä»¶è·¯å¾„å¤„ç†éœ€è¦åŠ å¼ºéªŒè¯
2. **OCR API**: APIå¯†é’¥å­˜å‚¨éœ€è¦æ›´å®‰å…¨çš„æ–¹å¼ï¼ˆå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
3. **æ‚£è€…æ•°æ®**: æ•æ„Ÿä¿¡æ¯å­˜å‚¨éœ€è¦åŠ å¯†

---

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°

### âœ… ä¼˜ç‚¹
1. **æ•°æ®åº“ç´¢å¼•**: å·²æ·»åŠ å¿…è¦çš„ç´¢å¼• âœ…
2. **å»¶è¿ŸåŠ è½½**: ä½¿ç”¨ Riverpod è¿›è¡ŒçŠ¶æ€ç®¡ç† âœ…
3. **å›¾ç‰‡å¤„ç†**: æœ‰æ–‡ä»¶å¤§å°é™åˆ¶æ£€æŸ¥ âœ…

### âš ï¸ ä¼˜åŒ–å»ºè®®
1. **åˆ—è¡¨ä¼˜åŒ–**: é•¿åˆ—è¡¨å»ºè®®ä½¿ç”¨ `ListView.builder`
2. **å›¾ç‰‡ç¼“å­˜**: å»ºè®®æ·»åŠ å›¾ç‰‡ç¼“å­˜æœºåˆ¶
3. **æ•°æ®åº“æŸ¥è¯¢**: å»ºè®®æ·»åŠ åˆ†é¡µåŠ è½½

---

## ğŸ¯ ä¼˜å…ˆä¿®å¤æ¸…å•

### ğŸ”´ P0 - ç«‹å³ä¿®å¤ (é˜»å¡ç¼–è¯‘)
- [ ] ä¿®å¤ `range.min/max` â†’ `range.minValue/maxValue` (13å¤„)
- [ ] ä¿®å¤ç¼ºå°‘çš„ `ranges` å‚æ•°
- [ ] ä¿®å¤æœªå®šä¹‰çš„ `normalRanges` å‚æ•°

### ğŸŸ¡ P1 - æœ¬å‘¨ä¿®å¤
- [ ] åˆ é™¤æœªä½¿ç”¨çš„ import (5å¤„)
- [ ] ä¿®å¤æœªä½¿ç”¨çš„å˜é‡
- [ ] æ·»åŠ  mockito ä¾èµ–
- [ ] ä¿®å¤æµ‹è¯•æ–‡ä»¶çš„å¯¼å…¥é—®é¢˜

### ğŸŸ¢ P2 - ä¸‹å‘¨ä¼˜åŒ–
- [ ] æ›¿æ¢å¼ƒç”¨çš„ `withOpacity` API (10å¤„)
- [ ] ä¿®å¤ BuildContext å¼‚æ­¥ä½¿ç”¨è­¦å‘Š
- [ ] å®Œå–„ API æ–‡æ¡£æ³¨é‡Š
- [ ] åŠ å¼ºå®‰å…¨æ€§æ£€æŸ¥

---

## ğŸ† ä¼˜ç‚¹è‚¯å®š

### âœ… æ¶æ„è®¾è®¡
1. **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„åˆ†å±‚è®¾è®¡ï¼ˆCore/Data/Domain/Presentationï¼‰
2. **Repositoryæ¨¡å¼**: è‰¯å¥½çš„æ•°æ®è®¿é—®å±‚æŠ½è±¡
3. **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ Riverpod è¿›è¡Œä¾èµ–ç®¡ç†

### âœ… ä»£ç è´¨é‡
1. **ç±»å‹å®‰å…¨**: å¹¿æ³›ä½¿ç”¨å¼ºç±»å‹
2. **ç©ºå®‰å…¨**: æ­£ç¡®ä½¿ç”¨äº† null safety
3. **é”™è¯¯å¤„ç†**: æœ‰åŸºæœ¬çš„é”™è¯¯å¤„ç†æœºåˆ¶

### âœ… åŠŸèƒ½å®Œæ•´
1. **åŠŸèƒ½è¦†ç›–**: å®ç°äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **æµ‹è¯•è¦†ç›–**: ç¼–å†™äº†å¤§é‡æµ‹è¯•ç”¨ä¾‹
3. **æ–‡æ¡£å®Œå–„**: æœ‰ API æ–‡æ¡£å’Œé¡¹ç›®ç®¡ç†æ–‡æ¡£

---

## ğŸ“ ä¿®å¤ä»£ç ç¤ºä¾‹

### ä¿®å¤å‘½åä¸ä¸€è‡´
```dart
// lib/presentation/widgets/indicator_input.dart
String _getReferenceRangeText() {
  if (widget.standard.normalRanges.isEmpty) return '';

  final range = widget.standard.normalRanges.first;
  // ä¿®å¤å‰: range.min / range.max
  // ä¿®å¤å: range.minValue / range.maxValue
  if (range.minValue != null && range.maxValue != null) {
    return '${range.minValue} - ${range.maxValue} ${widget.standard.unit}';
  } else if (range.minValue != null) {
    return 'â‰¥ ${range.minValue} ${widget.standard.unit}';
  } else if (range.maxValue != null) {
    return 'â‰¤ ${range.maxValue} ${widget.standard.unit}';
  }
  return '';
}
```

### ä¿®å¤å¼ƒç”¨API
```dart
// ä¿®å¤å‰
Colors.blue.withOpacity(0.1)

// ä¿®å¤å
Colors.blue.withValues(alpha: 0.1)
```

### ä¿®å¤ BuildContext å¼‚æ­¥ä½¿ç”¨
```dart
// ä¿®å¤å‰
final result = await _pdfService.exportToPDF(...);
Navigator.push(context, ...); // å±é™©ï¼

// ä¿®å¤å
final result = await _pdfService.exportToPDF(...);
if (!mounted) return; // å®‰å…¨æ£€æŸ¥
Navigator.push(context, ...);
```

---

## ğŸ“Š ä»£ç å®¡æŸ¥ç»“è®º

**æ€»ä½“è¯„ä»·**: é¡¹ç›®æ¶æ„è®¾è®¡è‰¯å¥½ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œä½†å­˜åœ¨ä¸€äº›ç¼–è¯‘é”™è¯¯éœ€è¦ç«‹å³ä¿®å¤ã€‚ä»£ç è§„èŒƒæ€§å’Œå¯ç»´æŠ¤æ€§æœ‰æå‡ç©ºé—´ã€‚

**å»ºè®®è¡ŒåŠ¨**:
1. **ç«‹å³**: ä¿®å¤æ‰€æœ‰ P0 çº§é”™è¯¯ï¼Œç¡®ä¿ä»£ç å¯ç¼–è¯‘
2. **æœ¬å‘¨**: ä¿®å¤ P1 çº§é—®é¢˜ï¼Œæé«˜ä»£ç è´¨é‡
3. **ä¸‹å‘¨**: å¤„ç† P2 çº§ä¼˜åŒ–é¡¹ï¼Œæå‡å¯ç»´æŠ¤æ€§

**ä¿®å¤åè¯„çº§é¢„æœŸ**: ğŸŸ¢ A- (è‰¯å¥½)

---

*å®¡æŸ¥äºº*: AIä»£ç å®¡æŸ¥åŠ©æ‰‹  
*ä¸‹æ¬¡å®¡æŸ¥*: å»ºè®®ä¿®å¤åé‡æ–°å®¡æŸ¥  
